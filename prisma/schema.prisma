generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  TUTOR
  STUDENT
}

enum UserStatus {
  ACTIVE
  BANNED
}

enum BookingStatus {
  CONFIRMED
  CANCELED
  COMPLETED
}

model User {
  id       String     @id @default(uuid())
  email    String     @unique
  password String
  name     String
  role     UserRole
  status   UserStatus @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tutorProfile TutorProfile?
  bookings     Booking[]
  reviews      Review[]

  @@index([role])
  @@index([status])
  @@map("users")
}

model TutorProfile {
  id         String  @id @default(uuid())
  bio        String?
  experience Int
  hourlyRate Float

  isFeatured    Boolean @default(false)
  totalReviews  Int     @default(0)
  averageRating Float   @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  availability Availability[]
  categories   Category[]     @relation("TutorCategories")
  bookings     Booking[]
  reviews      Review[]

  @@map("tutorProfiles")
}

model Category {
  id           String @id @default(uuid())
  categoryName String @unique

  createdAt DateTime @default(now())

  tutors TutorProfile[] @relation("TutorCategories")

  @@map("categories")
}

model Availability {
  id         String   @id @default(uuid())
  startTime  DateTime
  endTime    DateTime
  totalPrice Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  isBooked   Boolean  @default(false)

  tutorId      String
  tutorProfile TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  booking      Booking?

  @@index([tutorId])
  @@map("availabilities")
}

model Booking {
  id     String        @id @default(uuid())
  notes  String?
  status BookingStatus @default(CONFIRMED)

  tutorId        String
  studentId      String
  availabilityId String @unique

  createdAt DateTime @default(now())

  tutor        TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  student      User         @relation(fields: [studentId], references: [id], onDelete: Cascade)
  availability Availability @relation(fields: [availabilityId], references: [id], onDelete: Cascade)
  review       Review?

  @@index([studentId])
  @@index([tutorId])
  @@map("bookings")
}

model Review {
  id      String  @id @default(uuid())
  rating  Int
  comment String?

  createdAt DateTime @default(now())

  studentId String
  tutorId   String
  bookingId String @unique

  student User         @relation(fields: [studentId], references: [id], onDelete: Cascade)
  tutor   TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  booking Booking      @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@index([tutorId])
  @@index([studentId])
  @@map("reviews")
}
