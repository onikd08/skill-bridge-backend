generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  TUTOR
  STUDENT
}

enum UserStatus {
  ACTIVE
  BANNED
}

enum BookingStatus {
  CONFIREMED
  CANCELED
}

model User {
  id       String     @id @default(uuid())
  email    String     @unique
  password String
  name     String
  role     UserRole
  status   UserStatus @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tutorProfile TutorProfile?
  bookings     Booking[]

  @@index([role])
  @@index([status])
  @@map("users")
}

model TutorProfile {
  id         String  @id @default(uuid())
  bio        String?
  experience Int
  hourlyRate Float

  isFeatured Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  availability Availability[]
  categories   Category[]     @relation("TutorCategories")
  bookings     Booking[]

  @@map("tutorProfiles")
}

model Category {
  id           String @id @default(uuid())
  categoryName String @unique

  createdAt DateTime @default(now())

  tutors TutorProfile[] @relation("TutorCategories")

  @@map("categories")
}

model Availability {
  id         String   @id @default(uuid())
  startTime  DateTime
  endTime    DateTime
  totalPrice Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  tutorId      String
  tutorProfile TutorProfile @relation(fields: [tutorId], references: [id], onDelete: Cascade)
  booking      Booking?
}

model Booking {
  id     String        @id @default(uuid())
  notes  String?
  status BookingStatus @default(CONFIREMED)

  tutorId        String
  studentId      String
  availabilityId String @unique

  tutor        TutorProfile @relation(fields: [tutorId], references: [id])
  student      User         @relation(fields: [studentId], references: [id])
  availability Availability @relation(fields: [availabilityId], references: [id])
}
